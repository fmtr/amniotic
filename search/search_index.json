{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":"<p>How Do I Get Started?</p> <p>See the Quick Start section.</p>"},{"location":"#amniotic","title":"Amniotic","text":"<p>A multi-output ambient sound mixer for Home Assistant.</p> <p>Amniotic lets you use a single device to create on-the-fly, custom ambient audio mixes - e.g. mixing Waterfall sounds with Birdsong on one media player entity, while playing Fireplace sounds from a second audio device - to suit your tastes and environment.</p> <p>The library integrates with Home Assistant via MQTT as a new device, allowing you to create and control ambient mixes from the Home Assistant interface.</p>"},{"location":"#why-would-i-want-such-a-thing","title":"Why Would I Want Such a Thing?","text":"<p>I won't explain the general reasons for introducing non-musical sounds into one's environment, but if you find sound masking helps you concentrate in noisy environments, if you're (as I am) slightly misophonic, if you use white noise machines to induce sleep or relaxation, or if you just think sound is an important factor in setting a pleasant ambience, then you might find Amniotic useful.</p>"},{"location":"#cant-i-do-this-with-spotify-volumio-hifiberry-etc","title":"Can't I do This with Spotify, Volumio, HifiBerry etc.?","text":"<p>Since those systems are intended for music, they aren't designed for playing or mixing multiple streams simultaneously with a single device, even if set up in multi-room configurations. Also, the streaming services often won't allow a single account to play multiple streams, even if multiple devices are used.</p> <p>Anyway, those limitations motivated this library.</p> <p>There are two ways to install and run Amniotic:</p> <ul> <li>On the Home Assistant machine itself, as an add-on.</li> <li>Install manually, on a separate machine.</li> </ul>"},{"location":"#home-assistant-addon","title":"Home Assistant Addon","text":"<p>To add as an Addon, click here:</p> <p></p> <p></p>"},{"location":"#documentation","title":"Documentation","text":"<p>See Documentation</p>"},{"location":"addon-install-button/","title":"Addon install button","text":""},{"location":"players/","title":"Players","text":""},{"location":"players/#media-player-entities","title":"Media Player Entities","text":"<p>Amniotic principally streams audio to Media Players Entities controlled by Home Assistant.</p> <p>Info</p> <p>Your media player needs to support streaming from a basic HTTP stream, which most should.</p>"},{"location":"players/#do-i-need-a-fancy-sonos-type-speaker-cant-i-just-use-a-raspberry-pi-etc","title":"Do I need a fancy Sonos-type Speaker? Can't I just use a Raspberry Pi, etc?","text":"<p>You can use basically any device you can expose to Home Assistant as a Media Player entity. For something like a Raspberry Pi, for example:</p> <ul> <li>In Home Assistant, install the VLC Telnet integration.</li> <li>On your Device, install VLC, and start it in telnet mode, e.g.   <code>vlc -I telnet --telnet-password password --telnet-host 0.0.0.0:4212</code></li> <li>Add your device to the VLC Telnet integration.</li> <li>Restart Amniotic, and you should see your new device in the Amniotic Media Player pull-down.</li> </ul>"},{"location":"players/#manual-streams","title":"Manual Streams","text":"<p>Ultimately, though, Amniotic just exposes your Themes as regular HTTP/MP3 streams, so you can use any player that supports that. For this purpose, Amniotic exposes the \"Stream URL\" control (see Dashboard). You can paste this URL to into any player whatsoever, including a desktop browser, phone, etc.</p>"},{"location":"quick-start/","title":"Quick Start","text":"<p>The easiest way to get started is to:</p>"},{"location":"quick-start/#install","title":"Install","text":"<ul> <li>Install as an Addon, using the button above.</li> <li>If you're using a non-default address for Home Assistant on your network (i.e. not   <code>homeassistant.local</code>), set that in the Addon configuration.</li> <li>Add some audio files to the Home Assistant <code>/media/Amniotic</code> directory.</li> <li>Add the Lovelace Dashboard</li> </ul>"},{"location":"quick-start/#usage","title":"Usage","text":"<p>With the Addon and Dashboard installed:</p> <ul> <li>Keep the Default Theme selected while you're getting started.</li> <li>Select a Recording from the dropdown.</li> <li>Toggle to Enable the Recording.</li> <li>Select a Media Player to stream the Theme to.</li> <li>Click Stream to Media Player.</li> <li>Your Theme should start playing on your Media Player.</li> <li>You can now Enable additional Recordings in the Theme, modify their volume, etc., to create a custom mix.</li> <li>Note: there's also a Current Theme URL, for if you want to manually paste stream to a non-HA player, like a phone or something.</li> </ul>"},{"location":"recordings/","title":"Recordings","text":"<p>What's a Recording?</p> <p>Recording just means a atomic, un-mixed piece of ambient audio content represented by a file on disk, like birdsong, white noise, etc. The name has been chosen to differentiate the ambient nature of the content from terms typically used by music-focused services like Spotify.</p> <p>There are two ways to add Recordings to Amniotic:</p> <ul> <li>The easier way: Populate them with YouTube links, via the Home Assistant interface.</li> <li>The more manual way: Copy audio files (e.g. MP3) to audio folder directly.</li> </ul> <p>Why YouTube?</p> <p>Originally I'd planned Spotify integration. But on the very day I started to work on it, the <code>libspotify</code>  API was closed down. Anyway, since I wanted some kind of cloud integration (so as not to strictly require local files), and because YouTube contains a lot ambient audio content, I though that it would make for a decent solution, at least for the meantime.</p>"},{"location":"recordings/#adding-recordings-manually","title":"Adding Recordings Manually","text":""},{"location":"recordings/#addon-via-media-browser","title":"Addon via Media Browser","text":"<p>If you're running as a Home Assistant addon, you can simply use the Home Assistant Media Browser to add/modify Recordings.</p> <p></p> <p>With the Media Browser open, navigate to \"My media\" -&gt; \"Amniotic\".</p>"},{"location":"recordings/#directory-structure","title":"Directory Structure","text":"<p>The directory structure must be flat - as Amniotic won't look in subfolders.</p>"},{"location":"recordings/#example-directory-structure","title":"Example Directory Structure","text":"<ul> <li><code>/media/Amniotic</code><ul> <li><code>Birdsong - Wren at Dawn.mp3</code></li> <li><code>Birdsong - Starling in Trees.mp3</code></li> <li><code>Rainfall - Rain in forest.m4a</code></li> <li><code>Rainfall - Downpour on tent.webm</code></li> <li><code>Fireplace - Roaring wood stove (loopable).mp3</code></li> <li>...</li> </ul> </li> </ul>"},{"location":"recordings/#non-addon","title":"Non-Addon","text":"<p>If you're not running as an addon, you'll need to manually copy audio files to whatever path on your host machine that you mapped into the container.</p>"},{"location":"recordings/#audio-formats","title":"Audio Formats","text":"<p>Since Amniotic uses the Python FFMPEG bindings, it should support any format FFMPEG does - but probably safest to stick to simple audio formats, MP3, M4A etc., which have been tested during development.</p>"},{"location":"themes/","title":"Themes","text":"<p>Amniotic lets you define multiple Themes, each of which you can stream to separate Media Player entities.</p> <p>What's a Theme?</p> <p>Theme here just means a custom, named mix of one or more Recordings, their relative volumes, etc. So a simple Theme might be called \"Relaxing Sleep Sounds\" and involve two Recordings: one Recording of Birdsong, for example, at 20% volume, mixed with a second Recording, say of white noise, at 12% volume.</p>"},{"location":"themes/#creating-themes-via-home-assistant-controls","title":"Creating Themes via Home Assistant Controls","text":"<p>Themes can be created, deleted, edited and played via the Lovelace Dashboard in Home Assistant. Switching between Themes with the Theme pull-down, you'll be able to edit them by choosing which Recordings are enabled for that Theme, set their relative volumes etc.</p> <p>Themes persist, and are saved to disk when modified in any way.</p> <p>When running for the first time, you'll have a single theme called Default . You can add new Themes by entering a name into the New Theme control.</p>"},{"location":"install/dashboard/","title":"Dashboard","text":"<p>Below is an example dashboard for the Amniotic integration. You don't need to use this dashboard, and can create your own. but it's a good starting point.</p>"},{"location":"install/dashboard/#adding-the-dashboard-to-lovelace","title":"Adding the Dashboard to Lovelace","text":"<ul> <li>Click on the Copy  icon on the code box below.</li> <li>In your Home Assistant UI, navigate to a dashboard you'd like to add the View to.</li> <li>Click on the Edit Dashboard icon.</li> <li>Click the <code>+</code> to add a new View.</li> <li>Click on the three dots in the top right corner of the new View editor, and select <code>Edit in YAML</code>.</li> <li>Overwrite the entire edit box with the contents of your clipboard.</li> <li>Click <code>Save</code>.</li> <li>Click <code>Done</code> in the dashboard editor.</li> </ul> Dashboard Code <pre><code>title: Amniotic\nsections:\n  - type: grid\n    cards:\n      - type: heading\n        heading: Theme\n        heading_style: title\n      - type: tile\n        grid_options:\n          columns: 48\n          rows: 1\n        entity: select.amniotic_theme\n        name: Theme\n        vertical: false\n        features:\n          - type: select-options\n        features_position: bottom\n      - type: entities\n        entities:\n          - entity: button.amniotic_delete_current_theme\n          - entity: text.amniotic_new_theme\n          - entity: sensor.amniotic_stream_url\n            name:\n              type: entity\n        grid_options:\n          columns: 18\n          rows: auto\n    column_span: 4\n  - type: grid\n    cards:\n      - type: heading\n        heading_style: title\n        heading: Current Recording\n      - type: tile\n        grid_options:\n          columns: 48\n          rows: 1\n        entity: select.amniotic_recording\n        name: Theme Recording\n        vertical: false\n        features:\n          - type: select-options\n        features_position: bottom\n      - type: tile\n        grid_options:\n          columns: 48\n          rows: 1\n        entity: switch.amniotic_enable_recording\n        name: Enable Current Recording in Theme\n        vertical: false\n        features_position: bottom\n        features:\n          - type: toggle\n      - type: tile\n        grid_options:\n          columns: 48\n          rows: 1\n        entity: number.amniotic_recording_volume\n        name: Current Recording Volume\n        vertical: false\n        features:\n          - style: slider\n            type: numeric-input\n        features_position: bottom\n    column_span: 4\n  - type: grid\n    cards:\n      - type: heading\n        heading: Media Players\n        heading_style: title\n      - type: tile\n        grid_options:\n          columns: 48\n          rows: 1\n        entity: select.amniotic_media_player\n        name: Media Player\n        vertical: false\n        features:\n          - type: select-options\n        features_position: bottom\n      - type: tile\n        grid_options:\n          columns: 48\n          rows: 1\n        entity: button.amniotic_stream\n        name: Stream Current Theme to Media Player\n        show_entity_picture: false\n        hide_state: true\n        vertical: false\n        features:\n          - type: button\n            action_name: Stream\n        features_position: bottom\n    column_span: 4\ntype: sections\nmax_columns: 4\nicon: mdi:waveform\ncards: [ ]\nheader:\n  card:\n    type: markdown\n    text_only: true\n    content: |-\n      # Amniotic\n      An ambient sound mixer for Home Assistant.\n</code></pre> Screenshot"},{"location":"install/docker/","title":"Running as a Docker Image","text":"<p>There's also a pre-built Docker Image available, so you can run on a NAS or home server etc. To run in container, use this command to map through sound devices, audio and config files:</p> compose <pre><code>services:\n  amniotic:\n    container_name: amniotic\n    hostname: amniotic\n    image: fmtr/amniotic:latest\n    restart: unless-stopped\n\n    # Expose container port to host\n    ports:\n      - \"8007:8080\"  # Amniotic audio stream over HTTP port.\n\n    # Mount local audio and config directories to container\n    volumes:\n      - ./audio:/amniotic/audio\n      - ./config:/amniotic/config\n\n    environment:\n      # Home Assistant URL and token\n      AMNIOTIC__HA_CORE_API: \"http://homeassistant.local:8123/api\"  # API URL for your HA instance\n      SUPERVISOR_TOKEN: \"your_long_lived_access_token\"              # HA access token, to let Amniotic interact with media players. Generate here. https://my.home-assistant.io/redirect/profile_security/\n\n      # MQTT settings\n      AMNIOTIC__MQTT__HOSTNAME: \"mqtt.local\"   # MQTT broker hostname or IP\n      #AMNIOTIC__MQTT__PORT: \"1883\"             # Optional MQTT port (defaults to 1883 for TCP)\n      #AMNIOTIC__MQTT__USERNAME: \"mqtt_user\"    # Optional MQTT username\n      #AMNIOTIC__MQTT__PASSWORD: \"mqtt_pass\"    # Optional MQTT password\n\n      # Application-specific settings\n      AMNIOTIC__STREAM_URL: \"http://&lt;ip_or_hostname&gt;:8007\"  # URL where media players can access Amniotic on your network.\n      AMNIOTIC__PATH_AUDIO: \"/amniotic/audio\"               # Path inside container for audio files (mapped above)\n      AMNIOTIC__PATH_CONFIG: \"/amniotic/config\"              # Path inside container for config files (mapped above)\n\n    # No need for root\n    user: \"1000:1000\"\n</code></pre> .env <pre><code>TOKEN=123\n</code></pre>"},{"location":"install/native/","title":"Native","text":"<p>This section covers installing Amniotic outside of Home Assistant (i.e. on a separate, dedicated machine, a desktop PC, etc.)</p>"},{"location":"install/native/#hardware","title":"Hardware","text":"<p>Any vaguely suitable device (i.e. with a network connection and audio outputs) should work, but it was primarily intended for (and developed on) a dedicated Raspberry Pi 4B. The lowest spec I've tested on is a Pi Zero W 1, which works fine but struggled playing more than one Theme at a time. And obviously you'll have better results with better audio equipment (amps, speakers, etc.), especially for lower-frequency themes.</p>"},{"location":"install/native/#platform","title":"Platform","text":"<p>Raspbian/Debian are best tested and covered here. But for other platforms etc., see the Other Platforms section.</p>"},{"location":"install/native/#installing-on-raspberry-pi-linux","title":"Installing  on Raspberry Pi (Linux)","text":"<p>To install on Raspbian, or any Debian Linux etc., first install dependencies, then the Amniotic package:</p> <pre><code>sudo apt update -y\nsudo apt install -y python3-pip pulseaudio vlc\npip3 install amniotic\n</code></pre> <p>Once done, you should find <code>amnitoic</code> installed in  <code>~/.local/bin/amniotic</code></p>"},{"location":"install/native/#config-file","title":"Config File","text":"<p>You will need to add a config file at the path <code>~/.config/amniotic/config.yml</code>. It's primarily for adding your MQTT credentials. A commented example file that you can modify is  <code>config.example.yml</code>.</p>"},{"location":"install/native/#default-audio-directory","title":"Default Audio Directory","text":"<p>This can be set in the Config File, as above, but by default it's the following path: <code>~/.local/share/amniotic</code></p>"},{"location":"install/native/#running","title":"Running","text":"<p>You should now simply be able to run <code>~/.local/bin/amniotic</code>, which will connect to MQTT:</p> <pre><code>2022-05-20 15:14:51 INFO  amniotic.mqtt    : Amniotic 0.0.1 has started.\n2022-05-20 15:14:51 INFO  amniotic.mqtt    : Amniotic 0.0.1 starting MQTT...\n2022-05-20 15:14:51 INFO  amniotic.mqtt    : Attempting to connect to MQTT \"homeassistant.local:1883\": Connection successful\n</code></pre>"},{"location":"install/native/#installing-as-a-service","title":"Installing as a Service","text":"<p>Since a dedicated Amniotic device (e.g. a Pi) functions like an appliance, you might want to install as a service, so that restarts, running on boot etc., are handled automatically.</p> <ul> <li>Ensure the current user has session lingering enabled, to allow long-running services: <code>loginctl enable-linger $USER</code>.</li> <li>Copy the service unit file <code>amniotic.service</code> to   <code>~/.config/systemd/user/amniotic.service</code></li> <li>Enable the service: <code>systemctl --user enable amniotic.service</code>. The service should now start automatically on each   boot.</li> <li>If you want to start immediately: <code>systemctl --user start amniotic.service</code></li> <li>And to stop: <code>systemctl --user stop amniotic.service</code></li> <li>To view service logs: <code>journalctl --user --unit amniotic.service</code></li> </ul> <p>Installing on macOS using <code>brew</code> will look (roughly) like this:</p> <pre><code>brew install python3\nbrew install --cask vlc\npip3 install amniotic\n</code></pre>"},{"location":"install/native/#updating","title":"Updating","text":"<p>Amniotic also exposes its updater to Home Assistant, so newer versions can be installed from there. Updating will restart automatically and the device will reappear running the latest version, so all quite seamless.</p> <p>To update manually, enter:</p> <p><code>pip install amniotic --upgrade</code></p>"},{"location":"install/upgrading/","title":"Upgrading","text":""},{"location":"install/upgrading/#upgrading-from-amniotic-0x-and-fixing-entity-ids","title":"Upgrading from Amniotic 0.x and fixing entity IDs","text":"<p>If you upgraded from the old version and need to fix entity IDs:</p> <ul> <li>Go into Devices and find both old and new Amniotic devices.</li> <li>Delete both (MQTT Info -&gt; Delete)</li> <li>Restart the Add-On/Container, and just the new one should recreate itself.</li> <li>If you end up with funky Entity IDs (like   <code>select.amniotic_theme_2</code>) click in the  button in the Entity ID box.</li> </ul>"}]}